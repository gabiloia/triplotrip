import{ao as Ue,ap as re,bw as Ne,d as Le,a9 as F,cb as $e,cc as Ee,cd as We,ce as E,bi as Ke,k as qe,v as He,cf as se,au as Qe,aw as de,q as c,ay as N,aQ as ue,aP as Ye,p as g,cg as Ge,bo as Je,ba as Xe,a5 as Ze,az as et,bA as tt,ch as nt,ci as lt,cj as L,ck as at,aY as m}from"./8g3bmYip.js";import{p as $,f as it,c as ot,a as rt}from"./BMwUx3Op.js";import{N as st}from"./COrOQbGk.js";import{N as ut}from"./C221Cupi.js";const dt=Ue([re("select",`
 z-index: auto;
 outline: none;
 width: 100%;
 position: relative;
 font-weight: var(--n-font-weight);
 `),re("select-menu",`
 margin: 4px 0;
 box-shadow: var(--n-menu-box-shadow);
 `,[Ne({originalTransition:"background-color .3s var(--n-bezier), box-shadow .3s var(--n-bezier)"})])]),ct=Object.assign(Object.assign({},de.props),{to:E.propTo,bordered:{type:Boolean,default:void 0},clearable:Boolean,clearFilterAfterSelect:{type:Boolean,default:!0},options:{type:Array,default:()=>[]},defaultValue:{type:[String,Number,Array],default:null},keyboard:{type:Boolean,default:!0},value:[String,Number,Array],placeholder:String,menuProps:Object,multiple:Boolean,size:String,menuSize:{type:String},filterable:Boolean,disabled:{type:Boolean,default:void 0},remote:Boolean,loading:Boolean,filter:Function,placement:{type:String,default:"bottom-start"},widthMode:{type:String,default:"trigger"},tag:Boolean,onCreate:Function,fallbackOption:{type:[Function,Boolean],default:void 0},show:{type:Boolean,default:void 0},showArrow:{type:Boolean,default:!0},maxTagCount:[Number,String],ellipsisTagPopoverProps:Object,consistentMenuWidth:{type:Boolean,default:!0},virtualScroll:{type:Boolean,default:!0},labelField:{type:String,default:"label"},valueField:{type:String,default:"value"},childrenField:{type:String,default:"children"},renderLabel:Function,renderOption:Function,renderTag:Function,"onUpdate:value":[Function,Array],inputProps:Object,nodeProps:Function,ignoreComposition:{type:Boolean,default:!0},showOnFocus:Boolean,onUpdateValue:[Function,Array],onBlur:[Function,Array],onClear:[Function,Array],onFocus:[Function,Array],onScroll:[Function,Array],onSearch:[Function,Array],onUpdateShow:[Function,Array],"onUpdate:show":[Function,Array],displayDirective:{type:String,default:"show"},resetMenuOnOptionsChange:{type:Boolean,default:!0},status:String,showCheckmark:{type:Boolean,default:!0},onChange:[Function,Array],items:Array}),mt=Le({name:"Select",props:ct,slots:Object,setup(n){const{mergedClsPrefixRef:f,mergedBorderedRef:T,namespaceRef:h,inlineThemeDisabled:u}=Qe(n),W=de("Select","-select",dt,nt,n,f),z=c(n.defaultValue),ce=N(n,"value"),M=ue(ce,z),C=c(!1),w=c(""),j=Ye(n,["items","options"]),p=c([]),O=c([]),K=g(()=>O.value.concat(p.value).concat(j.value)),fe=g(()=>{const{filter:e}=n;if(e)return e;const{labelField:t,valueField:l}=n;return(r,i)=>{if(!i)return!1;const a=i[t];if(typeof a=="string")return $(r,a);const o=i[l];return typeof o=="string"?$(r,o):typeof o=="number"?$(r,String(o)):!1}}),he=g(()=>{if(n.remote)return j.value;{const{value:e}=K,{value:t}=w;return!t.length||!n.filterable?e:it(e,fe.value,t,n.childrenField)}}),ve=g(()=>{const{valueField:e,childrenField:t}=n,l=rt(e,t);return Ge(he.value,l)}),q=g(()=>ot(K.value,n.valueField,n.childrenField)),A=c(!1),v=ue(N(n,"show"),A),d=c(null),H=c(null),R=c(null),{localeRef:ge}=Je("Select"),me=g(()=>{var e;return(e=n.placeholder)!==null&&e!==void 0?e:ge.value.placeholder}),B=[],_=c(new Map),Q=g(()=>{const{fallbackOption:e}=n;if(e===void 0){const{labelField:t,valueField:l}=n;return r=>({[t]:String(r),[l]:r})}return e===!1?!1:t=>Object.assign(e(t),{value:t})});function U(e){const t=n.remote,{value:l}=_,{value:r}=q,{value:i}=Q,a=[];return e.forEach(o=>{if(r.has(o))a.push(r.get(o));else if(t&&l.has(o))a.push(l.get(o));else if(i){const s=i(o);s&&a.push(s)}}),a}const Y=g(()=>{if(n.multiple){const{value:e}=M;return Array.isArray(e)?U(e):[]}return null}),G=g(()=>{const{value:e}=M;return!n.multiple&&!Array.isArray(e)?e===null?null:U([e])[0]||null:null}),k=Xe(n),{mergedSizeRef:pe,mergedDisabledRef:I,mergedStatusRef:be}=k;function x(e,t){const{onChange:l,"onUpdate:value":r,onUpdateValue:i}=n,{nTriggerFormChange:a,nTriggerFormInput:o}=k;l&&m(l,e,t),i&&m(i,e,t),r&&m(r,e,t),z.value=e,a(),o()}function J(e){const{onBlur:t}=n,{nTriggerFormBlur:l}=k;t&&m(t,e),l()}function Oe(){const{onClear:e}=n;e&&m(e)}function ye(e){const{onFocus:t,showOnFocus:l}=n,{nTriggerFormFocus:r}=k;t&&m(t,e),r(),l&&P()}function Fe(e){const{onSearch:t}=n;t&&m(t,e)}function we(e){const{onScroll:t}=n;t&&m(t,e)}function X(){var e;const{remote:t,multiple:l}=n;if(t){const{value:r}=_;if(l){const{valueField:i}=n;(e=Y.value)===null||e===void 0||e.forEach(a=>{r.set(a[i],a)})}else{const i=G.value;i&&r.set(i[n.valueField],i)}}}function Z(e){const{onUpdateShow:t,"onUpdate:show":l}=n;t&&m(t,e),l&&m(l,e),A.value=e}function P(){I.value||(Z(!0),A.value=!0,n.filterable&&ie())}function b(){Z(!1)}function ee(){w.value="",O.value=B}const V=c(!1);function Se(){n.filterable&&(V.value=!0)}function Te(){n.filterable&&(V.value=!1,v.value||ee())}function Me(){I.value||(v.value?n.filterable?ie():b():P())}function Ce(e){var t,l;!((l=(t=R.value)===null||t===void 0?void 0:t.selfRef)===null||l===void 0)&&l.contains(e.relatedTarget)||(C.value=!1,J(e),b())}function Re(e){ye(e),C.value=!0}function Be(){C.value=!0}function Pe(e){var t;!((t=d.value)===null||t===void 0)&&t.$el.contains(e.relatedTarget)||(C.value=!1,J(e),b())}function Ae(){var e;(e=d.value)===null||e===void 0||e.focus(),b()}function _e(e){var t;v.value&&(!((t=d.value)===null||t===void 0)&&t.$el.contains(lt(e))||b())}function ke(e){if(!Array.isArray(e))return[];if(Q.value)return Array.from(e);{const{remote:t}=n,{value:l}=q;if(t){const{value:r}=_;return e.filter(i=>l.has(i)||r.has(i))}else return e.filter(r=>l.has(r))}}function te(e){D(e.rawNode)}function D(e){if(I.value)return;const{tag:t,remote:l,clearFilterAfterSelect:r,valueField:i}=n;if(t&&!l){const{value:a}=O,o=a[0]||null;if(o){const s=p.value;s.length?s.push(o):p.value=[o],O.value=B}}if(l&&_.value.set(e[i],e),n.multiple){const a=ke(M.value),o=a.findIndex(s=>s===e[i]);if(~o){if(a.splice(o,1),t&&!l){const s=ne(e[i]);~s&&(p.value.splice(s,1),r&&(w.value=""))}}else a.push(e[i]),r&&(w.value="");x(a,U(a))}else{if(t&&!l){const a=ne(e[i]);~a?p.value=[p.value[a]]:p.value=B}ae(),b(),x(e[i],e)}}function ne(e){return p.value.findIndex(l=>l[n.valueField]===e)}function Ie(e){v.value||P();const{value:t}=e.target;w.value=t;const{tag:l,remote:r}=n;if(Fe(t),l&&!r){if(!t){O.value=B;return}const{onCreate:i}=n,a=i?i(t):{[n.labelField]:t,[n.valueField]:t},{valueField:o,labelField:s}=n;j.value.some(y=>y[o]===a[o]||y[s]===a[s])||p.value.some(y=>y[o]===a[o]||y[s]===a[s])?O.value=B:O.value=[a]}}function xe(e){e.stopPropagation();const{multiple:t}=n;!t&&n.filterable&&b(),Oe(),t?x([],[]):x(null,null)}function Ve(e){!L(e,"action")&&!L(e,"empty")&&!L(e,"header")&&e.preventDefault()}function De(e){we(e)}function le(e){var t,l,r,i,a;if(!n.keyboard){e.preventDefault();return}switch(e.key){case" ":if(n.filterable)break;e.preventDefault();case"Enter":if(!(!((t=d.value)===null||t===void 0)&&t.isComposing)){if(v.value){const o=(l=R.value)===null||l===void 0?void 0:l.getPendingTmNode();o?te(o):n.filterable||(b(),ae())}else if(P(),n.tag&&V.value){const o=O.value[0];if(o){const s=o[n.valueField],{value:y}=M;n.multiple&&Array.isArray(y)&&y.includes(s)||D(o)}}}e.preventDefault();break;case"ArrowUp":if(e.preventDefault(),n.loading)return;v.value&&((r=R.value)===null||r===void 0||r.prev());break;case"ArrowDown":if(e.preventDefault(),n.loading)return;v.value?(i=R.value)===null||i===void 0||i.next():P();break;case"Escape":v.value&&(at(e),b()),(a=d.value)===null||a===void 0||a.focus();break}}function ae(){var e;(e=d.value)===null||e===void 0||e.focus()}function ie(){var e;(e=d.value)===null||e===void 0||e.focusInput()}function ze(){var e;v.value&&((e=H.value)===null||e===void 0||e.syncPosition())}X(),Ze(N(n,"options"),X);const je={focus:()=>{var e;(e=d.value)===null||e===void 0||e.focus()},focusInput:()=>{var e;(e=d.value)===null||e===void 0||e.focusInput()},blur:()=>{var e;(e=d.value)===null||e===void 0||e.blur()},blurInput:()=>{var e;(e=d.value)===null||e===void 0||e.blurInput()}},oe=g(()=>{const{self:{menuBoxShadow:e}}=W.value;return{"--n-menu-box-shadow":e}}),S=u?et("select",void 0,oe,n):void 0;return Object.assign(Object.assign({},je),{mergedStatus:be,mergedClsPrefix:f,mergedBordered:T,namespace:h,treeMate:ve,isMounted:tt(),triggerRef:d,menuRef:R,pattern:w,uncontrolledShow:A,mergedShow:v,adjustedTo:E(n),uncontrolledValue:z,mergedValue:M,followerRef:H,localizedPlaceholder:me,selectedOption:G,selectedOptions:Y,mergedSize:pe,mergedDisabled:I,focused:C,activeWithoutMenuOpen:V,inlineThemeDisabled:u,onTriggerInputFocus:Se,onTriggerInputBlur:Te,handleTriggerOrMenuResize:ze,handleMenuFocus:Be,handleMenuBlur:Pe,handleMenuTabOut:Ae,handleTriggerClick:Me,handleToggle:te,handleDeleteOption:D,handlePatternInput:Ie,handleClear:xe,handleTriggerBlur:Ce,handleTriggerFocus:Re,handleKeydown:le,handleMenuAfterLeave:ee,handleMenuClickOutside:_e,handleMenuScroll:De,handleMenuKeydown:le,handleMenuMousedown:Ve,mergedTheme:W,cssVars:u?void 0:oe,themeClass:S==null?void 0:S.themeClass,onRender:S==null?void 0:S.onRender})},render(){return F("div",{class:`${this.mergedClsPrefix}-select`},F($e,null,{default:()=>[F(Ee,null,{default:()=>F(st,{ref:"triggerRef",inlineThemeDisabled:this.inlineThemeDisabled,status:this.mergedStatus,inputProps:this.inputProps,clsPrefix:this.mergedClsPrefix,showArrow:this.showArrow,maxTagCount:this.maxTagCount,ellipsisTagPopoverProps:this.ellipsisTagPopoverProps,bordered:this.mergedBordered,active:this.activeWithoutMenuOpen||this.mergedShow,pattern:this.pattern,placeholder:this.localizedPlaceholder,selectedOption:this.selectedOption,selectedOptions:this.selectedOptions,multiple:this.multiple,renderTag:this.renderTag,renderLabel:this.renderLabel,filterable:this.filterable,clearable:this.clearable,disabled:this.mergedDisabled,size:this.mergedSize,theme:this.mergedTheme.peers.InternalSelection,labelField:this.labelField,valueField:this.valueField,themeOverrides:this.mergedTheme.peerOverrides.InternalSelection,loading:this.loading,focused:this.focused,onClick:this.handleTriggerClick,onDeleteOption:this.handleDeleteOption,onPatternInput:this.handlePatternInput,onClear:this.handleClear,onBlur:this.handleTriggerBlur,onFocus:this.handleTriggerFocus,onKeydown:this.handleKeydown,onPatternBlur:this.onTriggerInputBlur,onPatternFocus:this.onTriggerInputFocus,onResize:this.handleTriggerOrMenuResize,ignoreComposition:this.ignoreComposition},{arrow:()=>{var n,f;return[(f=(n=this.$slots).arrow)===null||f===void 0?void 0:f.call(n)]}})}),F(We,{ref:"followerRef",show:this.mergedShow,to:this.adjustedTo,teleportDisabled:this.adjustedTo===E.tdkey,containerClass:this.namespace,width:this.consistentMenuWidth?"target":void 0,minWidth:"target",placement:this.placement},{default:()=>F(Ke,{name:"fade-in-scale-up-transition",appear:this.isMounted,onAfterLeave:this.handleMenuAfterLeave},{default:()=>{var n,f,T;return this.mergedShow||this.displayDirective==="show"?((n=this.onRender)===null||n===void 0||n.call(this),qe(F(ut,Object.assign({},this.menuProps,{ref:"menuRef",onResize:this.handleTriggerOrMenuResize,inlineThemeDisabled:this.inlineThemeDisabled,virtualScroll:this.consistentMenuWidth&&this.virtualScroll,class:[`${this.mergedClsPrefix}-select-menu`,this.themeClass,(f=this.menuProps)===null||f===void 0?void 0:f.class],clsPrefix:this.mergedClsPrefix,focusable:!0,labelField:this.labelField,valueField:this.valueField,autoPending:!0,nodeProps:this.nodeProps,theme:this.mergedTheme.peers.InternalSelectMenu,themeOverrides:this.mergedTheme.peerOverrides.InternalSelectMenu,treeMate:this.treeMate,multiple:this.multiple,size:this.menuSize,renderOption:this.renderOption,renderLabel:this.renderLabel,value:this.mergedValue,style:[(T=this.menuProps)===null||T===void 0?void 0:T.style,this.cssVars],onToggle:this.handleToggle,onScroll:this.handleMenuScroll,onFocus:this.handleMenuFocus,onBlur:this.handleMenuBlur,onKeydown:this.handleMenuKeydown,onTabOut:this.handleMenuTabOut,onMousedown:this.handleMenuMousedown,show:this.mergedShow,showCheckmark:this.showCheckmark,resetMenuOnOptionsChange:this.resetMenuOnOptionsChange}),{empty:()=>{var h,u;return[(u=(h=this.$slots).empty)===null||u===void 0?void 0:u.call(h)]},header:()=>{var h,u;return[(u=(h=this.$slots).header)===null||u===void 0?void 0:u.call(h)]},action:()=>{var h,u;return[(u=(h=this.$slots).action)===null||u===void 0?void 0:u.call(h)]}}),this.displayDirective==="show"?[[He,this.mergedShow],[se,this.handleMenuClickOutside,void 0,{capture:!0}]]:[[se,this.handleMenuClickOutside,void 0,{capture:!0}]])):null}})})]}))}});export{mt as N};
